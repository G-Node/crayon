(function(){var a=function(a){var b=function(){};return b.prototype=a,new b};window.crayon={handle:{},deepcopy:a},crayon.version="0.0.6"})(),$(document).ready(function(){crayon.bus={subscribe:function(a,b){$(this).bind(a,b)},publish:function(a,b){$(this).trigger(a,b)}};var a=function(a){var b=this,c=!1;return oldymin=oldymax=undefined,b.ymax==undefined?(c=!0,b.ymin=a[0],b.ymax=a[1]):(b.ymin>a[0]&&(c=!0,oldymin=b.ymin,b.ymin=a[0]),b.ymax<a[1]&&(c=!0,oldymax=b.ymax,b.ymax=a[1])),c&&(b.y=d3.scale.linear().domain([b.ymin,b.ymax]).range([0,b.h-b.p]),crayon.bus.publish("RangeChanged",[b,{old:[oldymin,oldymax],"new":[b.ymin,b.ymax]}])),c},b=function(a){var b=this,c=!1,d=oldxmax=undefined;return b.xmax==undefined?(c=!0,b.xmin=a[0],b.xmax=a[1]):(b.xmin>a[0]&&(c=!0,d=b.xmin,b.xmin=a[0]),b.xmax<a[1]&&(c=!0,oldxmax=b.xmax,b.xmax=a[1])),c&&(b.x=d3.scale.linear().domain([b.xmin,b.xmax]).range([0,b.w-b.p]),crayon.bus.publish("DomainChanged",[b,{old:[d,oldxmax],"new":[b.xmin,b.xmax]}])),c},c=function(c){var d=d3.select(c),e=crayon.deepcopy(crayon.handle);e.div=d,e.p=20,e.w=parseInt(d.style("width")),e.h=parseInt(d.style("height"));var f=d.append("svg").attr("width",e.w).attr("height",e.h);return e.xmax=undefined,e.xmin=undefined,e.ymax=undefined,e.ymin=undefined,e.updateDomain=b,e.updateRange=a,e.element=f,e.grid||crayon.bus.publish("FirstDraw",[e]),e};crayon.init=c;var d=["#1BA5E0","#E68415","#E61F15","#2B6B1B","#97A30B"],e=function(){var a=0;return function(){return a%=d.length,d[a++]}};crayon.color=e(),crayon.bus.subscribe("FirstDraw",function(a,b,c){b.grid=b.element.append("g").attr("id","grid").attr("transform","translate("+b.p.toString()+","+(parseInt(b.h)-b.p).toString()+")"+"scale(1,-1)"),b.axes=b.grid.append("g").attr("class","axes"),b.axes.append("line").attr("x1","0").attr("y1","0").attr("x2","0").attr("y2",b.h),b.axes.append("line").attr("x1","0").attr("y1","0").attr("x2",b.w).attr("y2","0")}),crayon.bus.subscribe("DomainChanged",function(a,b,c){var d=b.x;b.grid.select("g.xrule").transition().style("opacity",0).remove(),b.xrules=b.grid.append("g").style("opacity","0").attr("class","xrule"),b.xrules.selectAll("line").data(d.ticks(10)).enter().append("line").attr("x1",d).attr("y1",0).attr("x2",d).attr("y2",b.h),b.xrules.selectAll("text").data(d.ticks(10)).enter().append("text").attr("transform","scale(1,-1)").attr("text-anchor","middle").attr("x",d).attr("y",15).text(function(a){return Math.round(a*1e3)/1e3}),b.xrules.transition().style("opacity","1")}),crayon.bus.subscribe("RangeChanged",function(a,b,c){var d=b.y;b.grid.select("g.yrule").transition().style("opacity",0).remove(),b.yrules=b.grid.append("g").style("opacity","0").attr("class","yrule"),b.yrules.selectAll("line").data(d.ticks(5)).enter().append("line").attr("x1",0).attr("y1",d).attr("x2",b.w).attr("y2",d),b.yrules.selectAll("text").data(d.ticks(5)).enter().append("text").attr("transform","scale(1,-1)").attr("text-anchor","end").attr("x",-3).attr("y",function(a){return-parseInt(d(a))}).text(function(a){return Math.round(a*1e3)/1e3}),b.yrules.transition().style("opacity","1")}),crayon.bus.subscribe("FirstDraw",function(a,b,c){b.signals=b.element.append("g").attr("id","signals").attr("transform","translate("+b.p.toString()+","+(parseInt(b.h)-b.p).toString()+")"+"scale(1,-1)")});var f=function(a,b){var c=this,d=!1,e=!1,f=ymax=Number.MIN_VALUE,g=ymin=Number.MAX_VALUE;for(var h=0;h<a.length;h++){var i=a[h];f=f<i.x?i.x:f,g=g>i.x?i.x:g,ymax=ymax<i.y?i.y:ymax,ymin=ymin>i.y?i.y:ymin}c.updateDomain([g,f]),c.updateRange([ymin,ymax]),crayon.bus.publish("SignalAdded",[c,a,b])};crayon.bus.subscribe("SignalAdded",function(a,b,c,d){b.signals.append("path").data([c]).style("stroke",crayon.color()).attr("id",d).attr("d",d3.svg.line().x(function(a){return b.x(a.x)}).y(function(a){return b.y(a.y)}))});var g=function(a,b,c){c.old!=c.new&&b.signals.selectAll("path").transition().attr("d",d3.svg.line().x(function(a){return b.x(a.x)}).y(function(a){return b.y(a.y)}))};crayon.bus.subscribe("RangeChanged",g),crayon.bus.subscribe("DomainChanged",g),crayon.handle.drawSignal=f});